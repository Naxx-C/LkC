#include "zx_fft.h"
//https://github.com/xiahouzuoxin/fft
#define  SAMPLE_NODES              (128)
COMPLEX x[SAMPLE_NODES];

static void MakeInput() {
    int i;

    for (i = 0; i < SAMPLE_NODES; i++) {
        x[i].real = sin(PI * 8 * i / SAMPLE_NODES);
        x[i].imag = 0.0f;
    }
}

static void MakeInputLk(float *f) {
    int i;

    for (i = 0; i < SAMPLE_NODES; i++) {
        x[i].real = f[i];
        x[i].imag = 0.0f;
    }
}

int fft_main(void) {
    int i = 0;

    /* TEST FFT */
    MakeInput();
    fft(x, SAMPLE_NODES);

    printf("\nfft\n");
    for (i = 0; i < SAMPLE_NODES; i++) {
        printf("%.5f %.5f %.5f\n", x[i].real, x[i].imag,
                sqrt(x[i].real * x[i].real + x[i].imag * x[i].imag) / (SAMPLE_NODES / 2));
    }

    printf("\nifft\n");
    ifft(x, SAMPLE_NODES);
    for (i = 0; i < SAMPLE_NODES; i++) {
        printf("%.5f %.5f %.5f\n", x[i].real, x[i].imag,
                sqrt(x[i].real * x[i].real + x[i].imag * x[i].imag) / (SAMPLE_NODES / 2));
    }

    /* TEST FFT with REAL INPUTS */
    MakeInput();
    printf("\nfft_real\n");
    fft_real(x, SAMPLE_NODES);

    for (i = 0; i < SAMPLE_NODES; i++) {
        printf("%.5f %.5f %.5f\n", x[i].real, x[i].imag,
                sqrt(x[i].real * x[i].real + x[i].imag * x[i].imag) / (SAMPLE_NODES / 2));
    }

    printf("\nifft_real\n");
    ifft_real(x, SAMPLE_NODES);

    for (i = 0; i < SAMPLE_NODES; i++) {
        printf("%.5f %.5f %.5f\n", x[i].real, x[i].imag,
                sqrt(x[i].real * x[i].real + x[i].imag * x[i].imag) / (SAMPLE_NODES / 2));
    }

    /* TEST FFT with REAL INPUTS */
    float f[128] = { 0.008, 0.007999999, -0.0019999994, 0.033, -0.013, 0.030000001, 0.006000001, 0.006000001,
            -0.0039999997, 0.018000001, 0.011, 0.029, -0.01, 0.0010000002, -0.019000001, -0.027999999, -0.009,
            -0.013, 0.013999999, 1.8659999, 3.462, 3.8179998, 3.1920002, 2.759, 2.6820002, 2.105, 1.927,
            2.094, 1.9549999, 1.873, 1.907, 1.88, 1.569, 1.632, 1.559, 1.341, 1.128, 0.98099995, 0.834,
            0.62100005, 0.24099998, -0.003, -0.003, -0.009, -0.019000001, 0.0139999995, -0.016, 0.038000003,
            -0.029, -0.013, -0.001, -0.016, -0.042, -0.012, 0.018, 0.007000001, 0.0069999993, -0.009, 0.023,
            0.038000003, 0.003, 0.011, -0.015999999, -0.021, -0.009, 0.008, 0.02, -0.021, -0.008,
            -0.0030000005, -0.044, -0.011, 0.052, -0.019, -0.037, -0.015000001, -0.026999999, 0.03, 0.044,
            0.025, 0.011, 0.052, -0.528, -2.07, -3.175, -3.497, -2.934, -2.7940001, -2.367, -2.194,
            -2.1000001, -1.924, -1.839, -1.928, -1.918, -1.814, -1.812, -1.737, -1.602, -1.375, -1.1320001,
            -0.95600003, -0.728, -0.612, -0.114, 0.026, -0.024999999, -0.0019999999, 0.015999999, -0.032,
            -0.015999999, 0.004, -0.001, -0.003, 0.007000001, -0.031, -0.018, -0.031, 0.0010000002,
            -0.019000001, 0.0, 0.049000002, -0.018000001, -0.01, 0.0019999994, 0.012, -0.009, 0.018000001,
            0.026, -0.0069999993, -0.022, -0.01, 0.010000001, 0.027999999, 0.015, -0.026, 0.02, 0.0010000002,
            0.013, 0.044, -0.026999999, 0.006, 0.0019999994, 0.0010000002, 0.0139999995, -0.041, 0.368, 1.985,
            3.234, 3.7580001, 3.101, 2.696, 2.628, 2.107, 1.962, 2.0219998, 1.8889999, 1.832, 1.939,
            1.9150001, 1.527, 1.613, 1.587, 1.38, 1.1639999, 0.94699997, 0.78900003, 0.62399995, 0.204,
            -0.009, 0.0, -0.027, -0.012, 0.013, 0.0030000005, 0.023, 0.0139999995, -0.025, -0.026,
            -0.0020000003, 0.0039999997, 0.036, -0.027999999, -0.014999999, -0.0010000002, -0.046, 0.011,
            0.026, 0.01, -0.004999999, -0.019000001, 0.026, -0.048, -0.021, -0.029, -0.031000001, -0.028,
            -0.004999999, -0.0030000005, 0.015, -0.014, -0.007, -0.013, 0.011, -0.009000001, 0.016999999,
            0.06, 0.029, -0.01, 0.036, -0.548, -2.04, -3.119, -3.451, -2.98, -2.8279998, -2.3830001, -2.178,
            -2.076, -1.908, -1.839, -1.897, -1.9200001, -1.81, -1.85, -1.725, -1.584, -1.4449999, -1.1930001,
            -0.964, -0.79399997, -0.60899997, -0.183, 0.008, 0.014999999, 0.009, 0.021, -0.013000001, 0.01,
            0.04, 0.033, 0.011, 0.017, 0.022, 0.012, -0.012, -0.014, -0.006, -0.008, 0.026999999, -0.013,
            -0.014, 0.014000002, 0.007, -0.024, -0.006000001 };



//    0.26000 0.00000 0.00406
//    20.00438 -76.83806 1.24062
//    -0.21505 -0.30093 0.00578
//    -41.08131 39.49537 0.89043
//    0.06104 0.43557 0.00687
//    26.79127 1.03889 0.41893
//    1.03152 -0.30111 0.01679
//    4.55581 -14.75495 0.24129
//    -1.48028 0.01045 0.02313
//    -20.53258 1.29606 0.32146
//    0.63821 0.72383 0.01508

    MakeInputLk(f);
    printf("\nfft_real\n");
    fft(x, SAMPLE_NODES);

    for (i = 0; i < SAMPLE_NODES; i++) {
        printf("%.5f %.5f %.5f\n", x[i].real, x[i].imag,
                sqrt(x[i].real * x[i].real + x[i].imag * x[i].imag) / (SAMPLE_NODES / 2));
    }

    return 0;
}
